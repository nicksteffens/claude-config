# Daily Logs - January 2026

## 2026-01-09

### Session Overview
**Duration:** 2-3 hours
**Main Objective:** Add cross-company lookup to V4 campaign pics controller with company switch handling
**Success Rating:** 8/10

### What We Accomplished
- Explored V3 and V4 controllers to understand company switch behavior differences
- Created feature branch `nicksteffens-claude/sc-183449/v4-campaign-pics-company-switch-error`
- Updated V4 `CampaignPicsController#show` to:
  - Look up campaigns by ID or key (matching V3 behavior)
  - Try current company first (including deleted/archived)
  - Fall back to cross-company lookup for active records
  - Auto-switch company when user has access
  - Return `meta.company_switched` boolean in response
- Added comprehensive tests for all cross-company scenarios
- Created backend PR: https://github.com/movableink/movableink/pull/7927
- Updated frontend `useCampaign` hook to auto-refresh app data on company switch
- Created frontend PR: https://github.com/movableink/front-end/pull/10292
- Updated CLAUDE.md branch naming convention (`+` â†’ `-`)

### Challenges Encountered
- Initial confusion about V3 behavior (auto-switch vs 403 error) - resolved by checking Canvas frontend code
- Frontend refresh not working with `invalidateQueries` due to `staleTime: Infinity`
- Iterated through multiple approaches: window.reload, useEffect, callback pattern
- Eventually solved with `resetQueries` + `useRevalidator` in the hook

### Most Valuable Collaboration
Debugging the frontend refresh issue together - iterating through different React Query and React Router patterns until finding the right combination.

### Key Insight
When React Query has `staleTime: Infinity`, use `resetQueries` instead of `invalidateQueries` to force a fresh fetch. Also, `useRevalidator` can be called inside custom hooks.

### Follow-Up Items
- [ ] Mark frontend PR as draft and add Rails PR reference
- [ ] Test end-to-end on staging once backend is deployed
- [ ] Consider adding similar company switch handling to other V4 endpoints

### Role Distribution
**Human:** Debugging together, providing context on V3 behavior and frontend requirements
**Claude:** Implementation, exploring codebase, iterating on solutions

### Success Factors
- Good codebase exploration revealed existing patterns (Canvas company-switcher service)
- Iterative debugging to find the right React Query/Router combination
- Clean separation - hook handles everything, component unchanged

---

## 2026-01-12

### Session Overview
**Duration:** 15-30 min
**Main Objective:** Enable move campaign tool for internal users with restricted company search
**Success Rating:** 9/10

### What We Accomplished
- Created Shortcut story [sc-183773](https://app.shortcut.com/movableink/story/183773)
- Updated OperatorTools visibility from `isOperator` to `isInternalUser`
- Added conditional rendering: only operators see "Restore All Blocks"
- Created `useCompaniesInTreeSearch` hook for hierarchy-restricted company search
- Internal users search within company tree; operators search all companies
- Header dynamically shows "Internal Tools" vs "Operator Tools"
- Investigated Canvas implementation for feature parity
- Documented findings in Shortcut comments (LOE for in-tree search)
- Created draft PR [#10306](https://github.com/movableink/front-end/pull/10306)
- Responded to Copilot's test coverage comment

### Challenges Encountered
- Minor type error with `companyId` in query key (fixed with `String()`)
- Initial property name mismatch (`isInternal` vs `isInternalUser`)

### Most Valuable Collaboration
Quick discovery of Canvas implementation differences and real-time documentation of findings in Shortcut.

### Key Insight
Canvas uses different search APIs for operators vs internal users - operators can search all companies, internal users are restricted to their company hierarchy. This is important for security/access control.

### Follow-Up Items
- [ ] Review and merge PR after CI passes
- [ ] Test in staging with both operator and internal user accounts
- [ ] Consider adding billing toggle and block mode tools (Canvas parity)

### Role Distribution
**Human:** Direction, quick decisions, feedback
**Claude:** Implementation, codebase exploration, documentation

### Success Factors
- Fast iteration with clear requirements
- Good codebase patterns to follow (existing hooks)
- Proactive discovery of Canvas implementation for parity

---

### Session Overview (Follow-up)
**Duration:** 5-10 min
**Main Objective:** Deprecate daily-log-agent in favor of daily-log skill
**Success Rating:** 10/10

### What We Accomplished
- Created issue [#35](https://github.com/nicksteffens/claude-config/issues/35) to deprecate daily-log-agent
- Removed `agents/daily-log-agent.md`
- Updated `CLAUDE.md` to reference skill instead of agent
- Updated `commands/daily-log.md` to use skill handoff
- Created and merged PR [#36](https://github.com/nicksteffens/claude-config/pull/36)
- Pushed daily logs to main

### Challenges Encountered
None - clean execution

### Key Insight
Skills are preferable to agents for simple workflows because they provide templates/conventions while keeping file operations in the main conversation flow. Agents add unpredictability and unnecessary context handoff overhead.

### Follow-Up Items
- [x] Issue closed automatically via PR merge

### Role Distribution
**Human:** Direction, quick merge
**Claude:** Implementation, git workflow

---
